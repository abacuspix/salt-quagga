{#
  Quagga OSPF Daemon configuration file, will yield if given in pillar:
  (note: this state only supports single area ospf)

  quagga:
    ospfd:
      enable: True
      networks:
        - 69.43.73.0/26
        - 10.0.11.0/24
      intefaces:
        eth0:
          cost: 2
#}

{% if pillar["quagga"]["ospfd"] %}
{% ospfd = pillar["quagga"]["ospfd"] %}
!
hostname {% grains['host'] + grains['domain'].split('.')[0] %}[ospfd]
password {% pillar['quagga']['enable_password'] %}
enable password {% pillar['quagga']['enable_password'] %}
log stdout
!
!
{% if ospfd["interfaces"] %}
{% for interface,cost in ospfd["interfaces"].items() %}
interface {{ interface }}
  ip ospf cost {{ cost }}
{% endfor %}

{% endif %}
!
!
router ospf
  {# Need to find a better way to do address selection for router-id, TWFN #}
  ospf router-id {{ salt["network.ip_addrs"][0] }}
! Important: ensure reference bandwidth is consistent across all routers
 auto-cost reference-bandwidth 102400
 {# Add in subnets on the current host, will need to be restarted on change. #}
 {% for subnet in list(set(salt["network.subnets"] + ospfd.get('networks',[]) %}
   network {{ subnet }} area 0.0.0.0
 {% endfor %}
!
line vty
!
{% else %}
! There was no pillar data for this host's ospfd daemon.
{% endif %}